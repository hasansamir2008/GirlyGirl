<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SAP Activate Assistant (Fiori Edition)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- Using Tailwind to approximate Fiori Design System -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* --- SAP FIORI THEME OVERRIDES --- */
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');

    body {
      font-family: "72", "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif; /* SAP's "72" font fallback */
      background-color: #edf0f4; /* Fiori Quartz Light Background */
      color: #32363a;
    }

    /* Shell Bar */
    .fiori-shell {
      background-color: #354a5f; /* Standard SAP Shell Color */
      color: #ffffff;
      height: 48px;
    }

    /* Object Header (Input Area) */
    .object-header {
      background-color: #ffffff;
      padding: 1.5rem 2rem;
      border-bottom: 1px solid #d9d9d9;
      margin-bottom: 2rem;
    }

    /* Input Fields Fiori Style */
    .fiori-input {
      border: 1px solid #89919a;
      border-radius: 0.25rem;
      padding: 0.5rem;
      font-size: 0.875rem;
      transition: all 0.2s;
      background-color: #fff;
    }
    .fiori-input:focus {
      border-color: #0070f2; /* SAP Action Blue */
      box-shadow: 0 0 0 1px #0070f2 inset;
      outline: none;
    }
    .fiori-label {
      color: #6a6d70;
      font-size: 0.75rem;
      font-weight: 400;
      margin-bottom: 0.25rem;
      display: block;
    }

    /* FIORI TILES (The Launchpad) */
    .tile-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(176px, 1fr));
      gap: 1rem;
      padding: 0 2rem 2rem 2rem;
    }

    .fiori-tile {
      background-color: #ffffff;
      border: 1px solid #d9d9d9;
      border-radius: 0.25rem;
      height: 176px;
      width: 100%;
      max-width: 176px;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      cursor: pointer;
      transition: box-shadow 0.2s, border-color 0.2s;
      position: relative;
    }

    .fiori-tile:hover {
      box-shadow: 0 0 10px 0 rgba(0,0,0,0.15);
      border-color: #0070f2;
    }

    .fiori-tile:active {
      background-color: #f5f7fa;
      border-color: #0070f2;
    }

    .tile-icon {
      font-size: 2.5rem;
      color: #0070f2; /* SAP Blue Icon */
    }
    
    /* Generic Tile for Exports */
    .tile-icon.neutral { color: #5d6873; }
    .tile-icon.risk { color: #bb0000; }

    .tile-title {
      font-size: 1rem;
      font-weight: 400;
      color: #32363a;
      line-height: 1.2;
    }
    
    .tile-subtitle {
      font-size: 0.75rem;
      color: #6a6d70;
      margin-top: 0.5rem;
    }

    /* Output Card */
    .fiori-card {
      background: #fff;
      border-radius: 0.25rem;
      box-shadow: 0 0 2px rgba(0,0,0,0.1);
      margin: 0 2rem 2rem 2rem;
      overflow: hidden;
    }
    .fiori-card-header {
      padding: 1rem;
      border-bottom: 1px solid #efefef;
      font-size: 1rem;
      font-weight: 700;
    }

    .loading-overlay {
      position: absolute; top:0; left:0; right:0; bottom:0;
      background: rgba(255,255,255,0.8);
      display: flex; justify-content: center; align-items: center;
      font-size: 0.875rem; color: #0070f2;
    }

    /* Hide logic */
    .hidden { display: none; }

  </style>
</head>
<body>

  <!-- 1. FIORI SHELL BAR -->
  <div class="fiori-shell flex items-center px-4 shadow-md z-50 relative">
    <div class="mr-4 text-xl">ğŸ’</div> <!-- SAP Logo Placeholder -->
    <div class="font-bold text-sm tracking-wide">SAP Activate Assistant</div>
    <div class="flex-grow"></div>
    <div class="text-xs opacity-80 mr-4">Hassan Samir Assistant</div>
    <div class="w-8 h-8 rounded-full bg-blue-400 flex items-center justify-center text-xs font-bold">HS</div>
  </div>

  <!-- 2. OBJECT HEADER (Input Context) -->
  <div class="object-header">
    <div class="max-w-7xl mx-auto">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
        <h1 class="text-2xl font-light text-gray-800 mb-2 md:mb-0">Project Event Context</h1>
        
        <!-- Model Selector in Header -->
        <div class="flex items-center space-x-2">
          <span class="fiori-label mb-0">AI Engine:</span>
          <select id="aiModelSelect" class="fiori-input h-8 py-0 text-sm">
             <option value="gemini" selected>Google Gemini 1.5 (Free)</option>
             <option value="chatgpt">ChatGPT (Paid Key)</option>
             <option value="claude">Claude 3 (Paid Key)</option>
          </select>
        </div>
      </div>

      <!-- Form Grid -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        
        <div class="md:col-span-2 flex flex-col gap-4">
          <!-- Event Title -->
          <div>
            <label class="fiori-label">Event Title</label>
            <input type="text" id="eventTitle" class="fiori-input w-full" value="">
          </div>

          <!-- Scenario Selector -->
          <div>
            <label class="fiori-label">Scenario / SAP Phase</label>
            <select id="agendaTopicSelect" class="fiori-input w-full">
               <option value="" disabled selected>Select SAP Scenario...</option>
            Â  Â Â 
Â  Â  Â  Â  Â  Â  Â <!-- Discover Phase -->
Â  Â  Â  Â  Â  Â  Â <optgroup label="Discover">
Â  Â  Â  Â  Â  Â  Â  Â <option value="Business process assessment">Business process assessment</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="System landscape review">System landscape review</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="RISE strategy workshops">RISE strategy workshops</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="Gap analysis vs standard SAP processes">Gap analysis vs standard SAP processes</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="High-level project plan creation">High-level project plan creation</option>
Â  Â  Â  Â  Â  Â  Â </optgroup>

Â  Â  Â  Â  Â  Â  Â <!-- Prepare Phase -->
Â  Â  Â  Â  Â  Â  Â <optgroup label="Prepare">
Â  Â  Â  Â  Â  Â  Â  Â <option value="System provisioning & landscape setup">System provisioning & landscape setup</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="Data model design and master data preparation">Data model design and master data preparation</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="Security & role design">Security & role design</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="Integration planning with existing systems">Integration planning with existing systems</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="Configure SAP Fiori and core modules">Configure SAP Fiori and core modules</option>
Â  Â  Â  Â  Â  Â  Â </optgroup>

Â  Â  Â  Â  Â  Â  Â <!-- Explore Phase -->
Â  Â  Â  Â  Â  Â  Â <optgroup label="Explore">
Â  Â  Â  Â  Â  Â  Â  Â <option value="Fit-to-Standard workshops for each module">Fit-to-Standard workshops for each module</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="Document configuration requirements">Document configuration requirements</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="Confirm custom development needs">Confirm custom development needs</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="Prepare configuration backlog">Prepare configuration backlog</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="Define test scenarios and UAT plan">Define test scenarios and UAT plan</option>
AN Â  Â  Â  Â  Â  </optgroup>

Â  Â  Â  Â  Â  Â  Â <!-- Realize Phase -->
Â  Â  Â  Â  Â  Â  Â <optgroup label="Realize">
Â  Â  Â  Â  Â  Â  Â  Â <option value="Configure SAP S/4HANA modules per design">Configure SAP S/4HANA modules per design</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="Develop custom enhancements if needed">Develop custom enhancements if needed</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="Integration testing with existing landscape">Integration testing with existing landscape</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="User acceptance testing (UAT)">User acceptance testing (UAT)</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="Finalize training materials">Finalize training materials</option>
Â  Â  Â  Â  Â  Â  Â </optgroup>

Â  Â  Â  Â  Â  Â  Â <!-- Deploy Phase -->
Â  Â  Â  Â  Â  Â  Â <optgroup label="Deploy">
Â  Â  Â  Â  Â  Â  Â  Â <option value="Cutover planning and execution">Cutover planning and execution</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="Data migration and validation">Data migration and validation</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="Go-live and hypercare support">Go-live and hypercare support</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="Post-go-live performance monitoring">Post-go-live performance monitoring</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="Transition to operations team">Transition to operations team</option>
Â  Â  Â  Â  Â  Â  Â </optgroup>

Â  Â  Â  Â  Â  Â  Â <!-- Run Phase -->
Â  Â  Â  Â  Â  Â  Â <optgroup label="Run">
Â  Â  Â  Â  Â  Â  Â  Â <option value="Ongoing support and issue resolution">Ongoing support and issue resolution</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="System optimization and continuous improvement">System optimization and continuous improvement</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="Periodic reviews and reporting">Periodic reviews and reporting</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="Enhancements and upgrade planning">Enhancements and upgrade planning</option>
Â  Â  Â  Â  Â  Â  Â  Â <option value="User adoption and change management">User adoption and change management</option>
Â  Â  Â  Â  Â  Â  Â </optgroup>

Â  Â  Â  Â  Â  Â  Â <!-- Other -->
Â  Â  Â  Â  Â  Â  Â <optgroup label="Other">
Â  Â  Â  Â  Â  Â  Â  Â <option value="Other">Other (Custom Topic)</option>
Â  Â  Â  Â  Â  Â  Â </optgroup>

            </select>
            <input type="text" id="agendaTopicCustom" class="fiori-input w-full mt-2 hidden" placeholder="Enter custom topic...">
          </div>

          <!-- NEW: Location Field with Map Button -->
          <div>
            <label class="fiori-label">Location / Room (Optional)</label>
            <div class="flex">
              <input type="text" id="eventLocation" class="fiori-input w-full rounded-r-none border-r-0" placeholder="e.g. SAP Cairo Office, Room 302">
              <button id="searchMapBtn" class="bg-white border border-l-0 border-gray-400 rounded-r px-3 hover:bg-gray-50 text-blue-600" title="Search on Google Maps">
                ğŸ“
              </button>
            </div>
          </div>

        </div>

        <!-- Right side inputs (Date/Time/Facilitator) -->
        <div class="md:col-span-2">
           <div class="flex gap-4 mb-4">
             <div class="w-1/2">
               <label class="fiori-label">Date</label>
               <input type="date" id="eventDate" class="fiori-input w-full">
             </div>
             <div class="w-1/2">
                <label class="fiori-label">Time</label>
                <div class="flex">
                  <input type="time" id="startTime" value="10:30" class="fiori-input w-full rounded-r-none border-r-0">
                  <input type="time" id="endTime" value="16:00" class="fiori-input w-full rounded-l-none">
                </div>
             </div>
           </div>
           <div>
             <label class="fiori-label">Facilitator</label>
             <input type="text" id="facilitator" value="Hassan Samir" class="fiori-input w-full">
           </div>
        </div>

      </div>
    </div>
  </div>

  <!-- 3. FIORI LAUNCHPAD (Action Tiles) -->
  <div class="max-w-7xl mx-auto">
    <h2 class="text-gray-600 text-sm uppercase font-bold tracking-wider ml-8 mb-4">Actions & Exports</h2>
    
    <div class="tile-grid">
      
      <!-- Tile 1: Draft Email -->
      <div class="fiori-tile" id="draftEmail">
        <div class="tile-icon">âœ‰ï¸</div>
        <div>
          <div class="tile-title">Draft Email</div>
          <div class="tile-subtitle">Generate Invitation</div>
        </div>
      </div>

      <!-- Tile 2: Generate Agenda -->
      <div class="fiori-tile" id="generateAgenda">
        <div class="tile-icon">ğŸ“‹</div>
        <div>
          <div class="tile-title">Agenda</div>
          <div class="tile-subtitle">Create Timetable</div>
        </div>
      </div>

      <!-- Tile 3: Risks -->
      <div class="fiori-tile" id="identifyRisks">
        <div class="tile-icon risk">âš ï¸</div>
        <div>
          <div class="tile-title">Risks</div>
          <div class="tile-subtitle">Identify Issues</div>
        </div>
      </div>

      <!-- Tile 4: Outlook -->
      <div class="fiori-tile" id="sendToOutlook">
        <div class="tile-icon neutral">ğŸ“¤</div>
        <div>
          <div class="tile-title">Open Outlook</div>
          <div class="tile-subtitle">Send as Mail</div>
        </div>
      </div>

      <!-- Tile 5: Google Meet -->
      <div class="fiori-tile" id="createGoogleMeet">
        <div class="tile-icon neutral">ğŸ“…</div>
        <div>
          <div class="tile-title">Google Meet</div>
          <div class="tile-subtitle">Create Event</div>
        </div>
      </div>

    </div>
  </div>

  <!-- 4. OUTPUT CARD -->
  <div class="max-w-7xl mx-auto">
    <div class="fiori-card">
      <div class="fiori-card-header">
        AI Assistant Output
      </div>
      <div class="relative">
        <textarea id="description" class="w-full h-64 p-4 border-none resize-y focus:outline-none text-sm font-mono text-gray-700" placeholder="Select a Scenario above and click an Action Tile to generate content..."></textarea>
        
        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="loading-overlay hidden">
          <div class="flex flex-col items-center">
            <span class="text-2xl animate-spin mb-2">ğŸ’ </span>
            <span>Processing with SAP Activate Context...</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ##################################################################
    // PASTE YOUR GOOGLE APPS SCRIPT WEB APP URL HERE
    const AI_API_ENDPOINT = "PASTE_YOUR_WEB_APP_URL_HERE"; 
    // ##################################################################

    document.getElementById('eventDate').valueAsDate = new Date();
    
    // Handle Custom Topic Toggle
    const topicSelect = document.getElementById('agendaTopicSelect');
    const topicCustom = document.getElementById('agendaTopicCustom');
    
    topicSelect.addEventListener('change', () => {
      if (topicSelect.value === 'Other') {
        topicCustom.classList.remove('hidden');
        topicCustom.focus();
      } else {
        topicCustom.classList.add('hidden');
      }
    });

    // Handle Location Map Search
    document.getElementById('searchMapBtn').addEventListener('click', () => {
      const loc = document.getElementById('eventLocation').value;
      if(loc) {
        window.open(`https://maps.google.com/?q=${encodeURIComponent(loc)}`, '_blank');
      } else {
        alert("Please enter a location first.");
      }
    });

    // Loading State Helper
    function toggleLoading(isLoading, message = "") {
      const overlay = document.getElementById('loadingOverlay');
      const outputBox = document.getElementById('description');
      if(isLoading) {
        overlay.classList.remove('hidden');
        overlay.querySelector('span:last-child').innerText = message;
      } else {
        overlay.classList.add('hidden');
      }
    }

    // --- MAIN AI LOGIC ---
    async function callAI(action) {
      const outputBox = document.getElementById('description');
      
      let topic = topicSelect.value;
      if (topic === 'Other') topic = topicCustom.value;

      if (!topic) {
        alert("Please select an SAP Scenario from the dropdown first.");
        return;
      }

      const model = document.getElementById('aiModelSelect').value;
      const modelName = model.charAt(0).toUpperCase() + model.slice(1);
      const location = document.getElementById('eventLocation').value;

      toggleLoading(true, `Generating ${action} using ${modelName}...`);

      // Check Config
      if (!AI_API_ENDPOINT.startsWith("https")) {
        console.warn("Backend URL missing. Running in Simulation Mode.");
        await new Promise(r => setTimeout(r, 1500)); 
        outputBox.value = generateSimulation(action, topic, location);
        toggleLoading(false);
        return;
      }

      const payload = {
        model: model,
        action: action,
        topic: topic,
        title: document.getElementById('eventTitle').value,
        date: document.getElementById('eventDate').value,
        startTime: document.getElementById('startTime').value,
        endTime: document.getElementById('endTime').value,
        facilitator: document.getElementById('facilitator').value,
        location: location // Passing location to backend
      };

      try {
        const res = await fetch(AI_API_ENDPOINT, {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain' },
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        if (data.error) throw new Error(data.error);
        outputBox.value = data.generatedText;
      } catch (err) {
        outputBox.value = "âŒ Error: " + err.message;
      } finally {
        toggleLoading(false);
      }
    }

    // --- ACTIONS ---
    document.getElementById('draftEmail').addEventListener('click', () => callAI('Email'));
    document.getElementById('generateAgenda').addEventListener('click', () => callAI('Agenda'));
    document.getElementById('identifyRisks').addEventListener('click', () => callAI('Risks'));

    document.getElementById('sendToOutlook').addEventListener('click', function() {
      const content = document.getElementById('description').value;
      if (!content) return alert("Generate content first.");
      const title = document.getElementById('eventTitle').value;
      const subject = `Invitation: ${title}`;
      window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(content)}`;
    });

    document.getElementById('createGoogleMeet').addEventListener('click', function() {
      const title = document.getElementById('eventTitle').value;
      const date = document.getElementById('eventDate').value;
      const start = document.getElementById('startTime').value;
      const end = document.getElementById('endTime').value;
      const location = document.getElementById('eventLocation').value; // Get Location
      
      if(!date || !start || !end) return alert("Please set date and time.");

      const formatTime = (d, t) => new Date(`${d}T${t}:00`).toISOString().replace(/-|:|\.\d\d\d/g, "");
      const dates = `${formatTime(date, start)}/${formatTime(date, end)}`;
      
      // If location is provided, use it; otherwise default to Google Meet
      const finalLocation = location ? location : "Google Meet (Online)";
      
      const url = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(title)}&dates=${dates}&details=${encodeURIComponent(document.getElementById('description').value)}&location=${encodeURIComponent(finalLocation)}`;
      window.open(url, '_blank');
    });

    // --- SIMULATION ---
    function generateSimulation(action, topic, location) {
      const title = document.getElementById('eventTitle').value;
      const phase = getPhase(topic);
      const locText = location ? location : "Hybrid / Online";

      if (action === 'Email') {
        return `Subject: ${title} - ${topic}\n\nDear Team,\n\nPlease join us for the ${topic} session (${phase} phase).\n\nWhere: ${locText}\n\nObjectives:\n- Define standard processes\n- Review Gaps\n\nRegards,\nHassan Samir`;
      } else if (action === 'Agenda') {
        return `1. Intro (10m)\n2. ${topic} Process Review (40m)\n3. Q&A (10m)`;
      }
      return `Risk 1: Missing Data.\nMitigation: Pre-load data templates.`;
    }

    function getPhase(t) {
       if(t.includes('Fit') || t.includes('Explore')) return 'Explore';
       if(t.includes('Realize') || t.includes('Sprint')) return 'Realize';
       return 'SAP Project';
    }

  </script>
</body>
</html>